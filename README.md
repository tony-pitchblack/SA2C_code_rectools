# SA2C (SASRec) â€” Torch + RecTools reimplementation

## Contents

- [Overview](#overview)
  - [Evaluation protocols](#evaluation-protocols)
  - [Notes](#notes)
  - [Clicks and puchases results](#clicks-and-puchases-results)
    - [RetailRocket (all events)](#retailrocket-all-events)
    - [YooChoose (all events)](#yoochoose-all-events)
  - [Purchase-only results](#purchase-only-results)
    - [RetailRocket (purchase-only)](#retailrocket-purchase-only)
    - [YooChoose (purchase-only)](#yoochoose-purchase-only)
    - [persrec_tc5_2025-08-21 (sa2c_eval)](#persrec_tc5_2025-08-21-sa2c_eval)
    - [persrec_tc5_2025-08-21 (bert4rec_eval)](#persrec_tc5_2025-08-21-bert4rec_eval)

## Overview
```bash
#TODO
```

### Evaluation protocols

`sa2c_eval` - eval according to SA2C paper: session-based split 80:10:10 (train/val/test), full-vocab metrics eval

`bert4rec_eval` - eval aligned with `bert4recv1` repo: LOO splits, supports partial vocab metrics eval (full-vocab by default)

### Notes

**NOTE 1:** `bert4recv` evaluation mode is NOT fully aligned with repo impl (metrics for similar runs in these two repos yielded different results; need review)

**NOTE 2:** recompute results for clicks+purchases for retailrocket/yoochoose and persrec* under bert4rec_eval were computed w/ partial vocab (`ce_n_negatives: 256`), need to recompute w/ full-vocab training

For full list of commands to reproduce experiments refer to `COMMANDS.md`

Plots were generated by
```bash
python scripts/plot_test_results.py --max-metric-value 1.0 0.6 0.3
```

### Clicks and puchases results

#### RetailRocket (all events)

![RetailRocket](results/plots/retailrocket/test_results.png)

#### YooChoose (all events)

![YooChoose](results/plots/yoochoose/test_results.png)

### Purchase-only results

#### RetailRocket (purchase-only)

![RetailRocket (purchase-only)](results/plots/retailrocket/test_results_purchase_only.png)

#### YooChoose (purchase-only)

![YooChoose (purchase-only)](results/plots/yoochoose/test_results_purchase_only.png)

#### persrec_tc5_2025-08-21 (sa2c_eval)

![persrec_tc5_2025-08-21 sa2c_eval](results/plots/persrec_tc5_2025-08-21/sa2c_eval/test_results.png)

#### persrec_tc5_2025-08-21 (bert4rec_eval)

**WARNING:** probably incorrect evaluation (not 1:1 LOO `bert4recv1` evaluation, see `NOTE 2`)

**TODO:** stacking more transformer layers & heads (a.k.a approx hparams experiment) is promising, need to be re-evaluated in `bert4recv` repo

![persrec_tc5_2025-08-21 bert4rec_eval](results/plots/persrec_tc5_2025-08-21/bert4rec_eval/test_results.png)

